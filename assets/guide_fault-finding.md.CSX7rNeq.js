import{_ as t,c as o,a3 as n,o as a}from"./chunks/framework.DiIf0t36.js";const i="/sunsynk/assets/modbus_sn.CXi1X5FJ.png",s="/sunsynk/assets/rs485-term.Ci2YB5Ur.jpg",m=JSON.parse('{"title":"Fault finding","description":"","frontmatter":{},"headers":[],"relativePath":"guide/fault-finding.md","filePath":"guide/fault-finding.md","lastUpdated":1755698340000}'),r={name:"guide/fault-finding.md"};function l(c,e,d,u,h,p){return a(),o("div",null,e[0]||(e[0]=[n(`<h1 id="fault-finding" tabindex="-1">Fault finding <a class="header-anchor" href="#fault-finding" aria-label="Permalink to &quot;Fault finding&quot;">​</a></h1><h2 id="startup-process" tabindex="-1">Startup process <a class="header-anchor" href="#startup-process" aria-label="Permalink to &quot;Startup process&quot;">​</a></h2><p>The addon follows the following startup process:</p><ol><li><p>Load config, sensor definitions and schedules</p><p>The logs will show if you use any unknown or deprecated sensors, if you have anything wrong in your custom sensors, and the intended schedule for reading sensors.</p></li><li><p>Connect to the Inverter</p><p>Connect and read the Inverter details (i.e. serial number). This is the first step to ensure the connection is working.</p><p>If this read fails, you need to follow the fault finding guide below. It could be a cabling issue, a configuration issue, or a hardware issue.</p><p>If successful, the only check is that you have the correct serial number in your config. The log will show:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO    ############################################################</span></span>
<span class="line"><span>INFO                Inverter serial number &#39;*1234&#39;</span></span>
<span class="line"><span>INFO    ############################################################</span></span></code></pre></div><p>If the device settings was read successfully, it will read all configured sensors to ensure you have some values at startup</p></li><li><p>Connect to the MQTT server</p><p>Publish the discovery data for Home Assistant, and also remove discovery data if required</p><p>If this step fails, you will not see any entities in Home Assistant and you need to check your MQTT server settings.</p></li></ol><p>Once the startup is complete, the addon will continue to read &amp; publish sensor data. During this process you will occasianally see read failures. As long as this does not happen on every read, you can probably continue using the addon, but can consider reducing sensors, relaxing the read schedules, etc.</p><p>If you fail to get a reply from the inverter, typically if step #2 fails, please check the following:</p><h2 id="a-cabling-connection" tabindex="-1">(A) Cabling &amp; connection <a class="header-anchor" href="#a-cabling-connection" aria-label="Permalink to &quot;(A) Cabling &amp; connection&quot;">​</a></h2><p>While fault finding use as short as possible cable, outside any sprague/trunking. Once everything works, you can switch to a more permanent, much longer cable.</p><p>If you cannot establish a connection, check the RS485 adaptor and cabling. Are you plugged into the correct port, is your connector crimped correctly?</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The newer inverters have a combined RS485 and CAN-BUS port. If your battery is already using the port for its CAN-BUS communications, you need to split the cable to connect your RS485 connector. The following articles explains the wiring of the port:</p><ul><li><a href="https://solarenergyconcepts.co.uk/practical-and-diy/crc-error-solar-assistant/" target="_blank" rel="noreferrer">DIY cable split</a></li><li><a href="https://solar-assistant.io/help/deye/2_in_1_bms_port" target="_blank" rel="noreferrer">SolarAssistant&#39;s RJ45 splitter</a></li></ul></div><p>Other factors that might impact connection, or reliability:</p><ul><li>Use a RJ45 converter with a GROUND pin. Ensure the ground is connected.</li><li>Re-crimp your RJ45 connector.</li><li>Use a good quality solid CAT5e/CAT6 cable. <ul><li>Ensure the data line is using a twisted pair.</li></ul></li><li>Ensure your RS485 cable does not run parallel to other electrical cables (AC or DC), to reduce interference. e.g. in trunking. <ul><li>If interference is a problem, are you using a twisted pair in the cable?</li><li>If interference is a problem, it could also help to use a shielded cable. Ground the shield at ONE end only (i.e. on the USB adaptor side and then just use normal plastic RJ45 connector on the inverter side.)</li></ul></li><li>If you still fail to make a connection, test the line voltage resistor (see Reducing timeouts below)</li></ul><h2 id="b-configuration" tabindex="-1">(B) Configuration <a class="header-anchor" href="#b-configuration" aria-label="Permalink to &quot;(B) Configuration&quot;">​</a></h2><h3 id="check-the-modbus-server-id" tabindex="-1">Check the Modbus Server ID <a class="header-anchor" href="#check-the-modbus-server-id" aria-label="Permalink to &quot;Check the Modbus Server ID&quot;">​</a></h3><p>Ensure the Modbus Server ID (<code>MODBUS_ID</code> config setting) matches the configured <strong>Modbus SN</strong> value of the inverter. This value must not be zero.</p><p>View/update the Modbus server ID on your inverter under &quot;Advanced Settings&quot; / &quot;Multi-Inverter&quot;.</p><p>Please note that this can be reset to zero after a software upgrade on your inverter, and this will stop the addon from reading data from your inverter. Resetting it to the previous value (the value the value in <code>MODBUS_ID</code> if you had this working previously), and then restarting the inverter should fix the <a href="https://powerforum.co.za/topic/15779-home-assistant-no-longer-getting-data-after-sunsynk-firmware-update-solved/" target="_blank" rel="noreferrer">issue</a>.</p><p><img src="`+i+'" alt="Modbus Server ID" width="70%"></p><h3 id="only-a-single-connection-to-the-serial-port" tabindex="-1">Only a single connection to the serial port <a class="header-anchor" href="#only-a-single-connection-to-the-serial-port" aria-label="Permalink to &quot;Only a single connection to the serial port&quot;">​</a></h3><p>Ensure you only have a single addon connected to the serial port. The following can all potentially access the USB port: mbusd, Node RED, the normal and dev addon version.</p><p>If you need to have multiple connections to the serial port: ONLY connect mbusd to the serial port. Connect all addons to mbusd (e.g. tcp://192.168.1.x:503).</p><h2 id="c-reducing-timeouts" tabindex="-1">(C) Reducing timeouts <a class="header-anchor" href="#c-reducing-timeouts" aria-label="Permalink to &quot;(C) Reducing timeouts&quot;">​</a></h2><p>If you get many timeouts, or if the addon does not read all your sensors on startup (i.e. you see <strong>Retrying individual sensors</strong> in the log), you can try the following:</p><ul><li>Set <code>READ_SENSORS_BATCH_SIZE</code> to a smaller value, i.e. 8.</li><li>The most reliable way to connect is to use mbusd to the serial port &amp; connect the addon to mbusd at <code>tcp://&lt;ip&gt;:502</code>. The mbusd instance/addon can be on the same physical device or a remote device.</li></ul><p>Check the cabling and connection again. Use a 1m cable and stand next to the inverter while testing.</p><h3 id="direct-serial" tabindex="-1">Direct serial <a class="header-anchor" href="#direct-serial" aria-label="Permalink to &quot;Direct serial&quot;">​</a></h3><p>If your RS485 adaptor is plugged directly into your host, connecting directly to the serial port <code>PORT: &quot;/usb/ttyX&quot;</code> might not give you the best results.</p><p>Once you have a working connection (reading the serial), consider introducing <strong>mbusd</strong> into your setup, in this configuration mbus connects to the serial port and the addon connects via TCP, typically: <code>PORT: tcp://homeassistant.local:502</code></p><p><strong>mbusd</strong> and the <em>pymodbus</em> driver gives the best results.</p><h3 id="check-line-voltage-termination-resistor" tabindex="-1">Check line voltage / termination resistor <a class="header-anchor" href="#check-line-voltage-termination-resistor" aria-label="Permalink to &quot;Check line voltage / termination resistor&quot;">​</a></h3><p>If your RS485 adapter has a termination resistor (typically 120 ohms), try removing it.</p><p>To check, disconnect the adapter and use a multimeter to measure the resistance between A &amp; B.</p><p>The d.c. voltage between A/B on the sunsynk RS485 connection should idle around 4-5v with nothing connected, but this may drop to around 0.5v with the 120 ohm load.</p><p>RS485 devices are typically multi-drop with a termination resistor on the first and last devices. However, the RS485 BMS port may only be intended to connect to a single device.</p><p><img src="'+s+'" alt="RS485" width="70%"></p>',35)]))}const f=t(r,[["render",l]]);export{m as __pageData,f as default};
